<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"></head><body class="c52"><p class="c47 title" id="h.o7weefi3utkj"><span class="c8 c27">SpringOne Workshop Labs</span></p><p class="c39 subtitle" id="h.sjzfo8fcg7m4"><span class="c44">Building Event-Driven Workflows with Knative and Tekton</span></p><h1 class="c33" id="h.wj2ddq0na8"><span class="c12 c8">Preface</span></h1><h2 class="c20" id="h.diwi0tqu4krx"><span class="c36 c8">Icons used in this document</span></h2><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0786b0c4e914ac1611feba4a63fa25fa48803c97"></a><a id="t.0"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span>Information message, please read these carefully</span></p></td></tr><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c10 c8">Code snippet, you can use these snippets to complete the tasks</span></p></td></tr><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image3.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c10 c8">Do-It-Yourself, using the explanations try your hand at some exercises using the tools and technology in this workshop</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.kg10u44zid42"><span class="c36 c8">General notes</span></h2><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.95a1c7392986fead208ab5632871353f7f6147ec"></a><a id="t.1"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c43">The commands in this document have been created with Linux / macOS in mind. The Windows versions of these commands might differ from the examples.</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h1 class="c33" id="h.p6wrkvxueov7"><span class="c12 c8">Kubernetes in Docker</span></h1><h2 class="c20" id="h.oybitbkzegl"><span class="c36 c8">Install KinD</span></h2><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c37 c10 c8">kind is a tool for running local Kubernetes clusters using Docker container &ldquo;nodes&rdquo;.</span></p><p class="c2"><span class="c37 c10 c8">kind was primarily designed for testing Kubernetes itself, but may be used for local development or CI.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>Source: </span><span class="c42"><a class="c49" href="https://www.google.com/url?q=https://kind.sigs.k8s.io/&amp;sa=D&amp;ust=1599151576269000&amp;usg=AOvVaw3V7YZs5bHhTzF91ahTpRYl">KinD website</a></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">For this workshop you&rsquo;ll need version 0.8.0 or higher</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.1caeac0bf465f0cb10f4b625c5324668611864e1"></a><a id="t.2"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">curl -Lo </span><span class="c19">.</span><span class="c5">/kind</span><span class="c14">&nbsp;https</span><span class="c14 c34">:</span><span class="c5">//kind.sigs.k8s.io/dl/v0.8.1/kind-</span><span class="c14 c24">$(</span><span class="c14">uname </span><span class="c14 c38">-s</span><span class="c14 c24">)</span><span class="c4 c14 c8">-amd64</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">chmod +x </span><span class="c19">.</span><span class="c5">/kind</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">mv </span><span class="c19">.</span><span class="c5">/kind</span><span class="c14">&nbsp;</span><span class="c5">/some-dir-in-your-PATH/kind</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.ppg64dh9ipug"><span class="c36 c8">Create a Kubernetes cluster</span></h2><p class="c2"><span class="c4 c10 c8">You&rsquo;ll need to configure kind to expose port 80 to the host machine. That port will be used by Kourier (an ingress controller) a little later on.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2acd55f2f73f8d8bcafd1790ac2ea0ae3ff1a516"></a><a id="t.3"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">cat </span><span class="c14 c40">&gt;</span><span class="c14">&nbsp;clusterconfig</span><span class="c19">.</span><span class="c14">yaml </span><span class="c14 c50">&lt;&lt;</span><span class="c14 c40">EOF</span></p><p class="c2"><span class="c14 c32">kind: Cluster</span></p><p class="c2"><span class="c14 c32">apiVersion: kind.x-k8s.io/v1alpha4</span></p><p class="c2"><span class="c14 c32">nodes:</span></p><p class="c2"><span class="c14 c32">- role: control-plane</span></p><p class="c2"><span class="c14 c32">&nbsp; extraPortMappings:</span></p><p class="c2"><span class="c14 c32">&nbsp; - containerPort: 31080</span></p><p class="c2"><span class="c14 c32">&nbsp; &nbsp; hostPort: 80</span></p><p class="c2"><span class="c14 c40">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can create a new cluster, with the above configuration using the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b256aa57fd91d92f2ab80d112f3bd39efd58efca"></a><a id="t.4"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">kind create cluster --name springone --config clusterconfig</span><span class="c19">.</span><span class="c4 c14 c8">yaml</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h1 class="c33" id="h.c86ip4lbnk61"><span class="c12 c8">Some additional tools</span></h1><h2 class="c20" id="h.o5tt6m4l0rm2"><span>k</span><span class="c36 c8">ubectl</span></h2><p class="c2"><span>The Kubernetes command-line tool, kubectl, allows you to run commands against Kubernetes clusters. You can use kubectl to deploy applications, inspect and manage cluster resources, and view logs. You&rsquo;ll be working with Kubernetes, so you&rsquo;ll need the </span><span class="c3">kubectl</span><span class="c4 c10 c8">&nbsp;command line tool.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.82fe0a239c3f903b9fcd4681b11c09024bbe28be"></a><a id="t.5"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">curl -LO </span><span class="c14 c32">&quot;https:</span><span class="c5">//storage.googleapis.com/kubernetes-release/release/</span><span class="c14 c32">$(curl -s https:</span><span class="c5">//storage.googleapis.com/kubernetes-release/release/stable.txt</span><span class="c14 c32">)</span><span class="c5">/bin/linux/amd64/kubectl</span><span class="c14 c32">&quot;</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">chmod +x </span><span class="c19">.</span><span class="c5">/kubectl</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">mv </span><span class="c19">.</span><span class="c5">/kubectl</span><span class="c14">&nbsp;</span><span class="c5">/some-dir-in-your-PATH/kubectl</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.usl77e4d6ugf"><span class="c36 c8">kn</span></h2><p class="c2"><span>The command line tool that manages Knative is called kn. The tool manages both the eventing and serving parts of Knative. You&rsquo;ll build functions with Knative, so you&rsquo;ll need the </span><span class="c3">kn</span><span class="c4 c10 c8">&nbsp;command line tool.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.449cc35f936c63465ed1eb2c490999d6f90da3d3"></a><a id="t.6"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">curl -Lo </span><span class="c19">.</span><span class="c5">/kn</span><span class="c14">&nbsp;https</span><span class="c14 c34">:</span><span class="c5">//github.com/knative/client/releases/download/v0.16.0/kn-</span><span class="c14 c24">$(</span><span class="c14">uname </span><span class="c14 c38">-s</span><span class="c14 c24">)</span><span class="c4 c14 c8">-amd64</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">chmod +x </span><span class="c19">.</span><span class="c5">/kn</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">mv </span><span class="c19">.</span><span class="c5">/kn</span><span class="c14">&nbsp;</span><span class="c5">/some-dir-in-your-PATH/kn</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.ezaoc8ed4x6j"><span class="c36 c8">tkn</span></h2><p class="c2"><span>The command line tool that manages Tekton is called tkn. This tool allows you to access all Tekton resources needed in this workshop. You&rsquo;ll build pipelines with Tekton, so you&rsquo;ll need the </span><span class="c3">tkn</span><span class="c4 c10 c8">&nbsp;command line tool.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.a5189bdeee7f05e35725df4241a14307b15f0312"></a><a id="t.7"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">curl -LO https</span><span class="c14 c34">:</span><span class="c5">//github.com/tektoncd/cli/releases/download/v0.11.0/tkn_0.11.0_</span><span class="c14 c24">$(</span><span class="c14">uname </span><span class="c14 c38">-s</span><span class="c14 c24">)</span><span class="c14">_x86_64</span><span class="c19">.</span><span class="c14">tar</span><span class="c19">.</span><span class="c4 c14 c8">gz</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">tar xvzf tkn_0</span><span class="c19">.</span><span class="c14 c48">11</span><span class="c19">.</span><span class="c14">0_</span><span class="c14 c24">$(</span><span class="c14">uname </span><span class="c14 c38">-s</span><span class="c14 c24">)</span><span class="c14">_x86_64</span><span class="c19">.</span><span class="c14">tar</span><span class="c19">.</span><span class="c14">gz -C </span><span class="c5">/some-dir-in-your-PATH</span><span class="c4 c8 c14">&nbsp;tkn</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.q9x2c2bsem40"><span class="c36 c8">k9s</span></h2><p class="c2"><span class="c4 c10 c8">To keep track of what&rsquo;s happening in your cluster you can use K9s. K9s is a terminal based UI to interact with your Kubernetes clusters. The aim of this project is to make it easier to navigate, observe and manage your deployed applications in the wild. K9s continually watches Kubernetes for changes and offers subsequent commands to interact with your observed resources.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.fafe98b4e227049ee1b727c0afc347be5f1466e1"></a><a id="t.8"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">curl -LO https</span><span class="c14 c34">:</span><span class="c5">//github.com/derailed/k9s/releases/download/v0.21.4/k9s_</span><span class="c14 c24">$(</span><span class="c14">uname </span><span class="c14 c38">-s</span><span class="c14 c24">)</span><span class="c14">_x86_64</span><span class="c19">.</span><span class="c14">tar</span><span class="c19">.</span><span class="c4 c14 c8">gz</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">tar xvzf k9s_</span><span class="c14 c24">$(</span><span class="c14">uname </span><span class="c14 c38">-s</span><span class="c14 c24">)</span><span class="c14">_x86_64</span><span class="c19">.</span><span class="c14">tar</span><span class="c19">.</span><span class="c14">gz -C </span><span class="c5">/some-dir-in-your-PATH</span><span class="c4 c14 c8">&nbsp;k9s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h2 class="c20 c35" id="h.p744e7pheyo"><span class="c36 c8"></span></h2><h2 class="c20" id="h.iplva7vrbre2"><span class="c36 c8">Octant</span></h2><p class="c2"><span class="c4 c10 c8">Octant is an open source developer-centric web interface for Kubernetes that lets you inspect a Kubernetes cluster and its applications. It provides a visual interface to managing Kubernetes that complements and extends existing tools like kubectl and kustomize and supports a variety of debugging features such as filtering labels and streaming container logs to be part of the Kubernetes development toolkit. Throughout this workshop, you can use Octant to see what&rsquo;s happening in your cluster too.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.27d9ad8455623f795287e965638f8f686318c4f3"></a><a id="t.9"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c14 c8">To install Octant:</span></p><p class="c2"><span class="c14">* download the latest release from the Octant GitHub repository: </span><span class="c14 c42"><a class="c49" href="https://www.google.com/url?q=https://github.com/vmware-tanzu/octant/releases/tag/v0.15.0&amp;sa=D&amp;ust=1599151576287000&amp;usg=AOvVaw3lS55alLSytp_3mHSDapkJ">https://github.com/vmware-tanzu/octant/releases/tag/v0.15.0</a></span></p><p class="c2"><span class="c4 c14 c8">* extract the zipped or gzipped file</span></p><p class="c2"><span class="c4 c14 c8">* start the octant executable</span></p><p class="c2"><span class="c14">* open a webbrowser to http://127.0.0.1:7777</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h1 class="c33 c45" id="h.4pcpu313kcsm"><span class="c8 c12"></span></h1><h1 class="c33" id="h.mh50pyltanbq"><span class="c12 c8">Knative Serving</span></h1><h2 class="c20" id="h.59rwjdrskdpt"><span class="c36 c8">Install Knative Serving to your cluster</span></h2><p class="c2"><span class="c4 c10 c8">You&rsquo;re ready to install Knative serving. Knative components build on top of Kubernetes, abstracting away the complex details and enabling developers to focus on what matters. Built by codifying the best practices shared by successful real-world implementations, Knative solves the &ldquo;boring but difficult&rdquo; parts of deploying and managing cloud native services so you don&rsquo;t have to. Knative Serving runs serverless containers on Kubernetes with ease, Knative takes care of the details of networking, autoscaling (even to zero), and revision tracking. You just have to focus on your core logic.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.20866cdba1c713176c11a83ee5f52f2b414caffb"></a><a id="t.10"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">kubectl apply </span><span class="c14 c38">-f</span><span class="c14">&nbsp;https</span><span class="c14 c34">:</span><span class="c5">//github.com/knative/serving/releases/download/v0.16.0/serving-crds.yaml</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">kubectl apply </span><span class="c14 c38">-f</span><span class="c14">&nbsp;https</span><span class="c14 c34">:</span><span class="c5">//github.com/knative/serving/releases/download/v0.16.0/serving-core.yaml</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">kubectl </span><span class="c0">wait</span><span class="c14">&nbsp;deployment activator autoscaler controller webhook --</span><span class="c14 c22">for</span><span class="c14 c34">=</span><span class="c14 c22">condition</span><span class="c14 c34">=</span><span class="c14">Available </span><span class="c14 c38">-n</span><span class="c14">&nbsp;knative-serving --</span><span class="c14 c22">timeout</span><span class="c14 c34">=</span><span class="c4 c14 c8">-1s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>If you&rsquo;re curious what just happened to your cluster, you can check the Octant user interface on </span><span class="c3">http://127.0.0.1:7777</span><span class="c4 c10 c8">:</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 324.00px;"><img alt="" src="images/image4.png" style="width: 624.00px; height: 324.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c20" id="h.h87suk1dig8n"><span class="c36 c8">Setting up your ingress with Kourier</span></h2><p class="c2"><span>Kourier is an Ingress for &nbsp;Knative Serving. Kourier is a lightweight alternative for the Istio ingress as its deployment consists only of an Envoy proxy and a control plane for it. You&rsquo;ll need to install Kourier in the </span><span class="c3">kourier-system</span><span class="c4 c10 c8">&nbsp;namespace.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.9b648fbe5b3cd1b9610eb861187f8aea34319f92"></a><a id="t.11"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c14">kubectl apply </span><span class="c14 c38">-f</span><span class="c14">&nbsp;https</span><span class="c14 c34">:</span><span class="c5">//github.com/knative/net-kourier/releases/download/v0.16.0/kourier.yaml</span></p><p class="c2 c9"><span class="c4 c14 c8"></span></p><p class="c2"><span class="c14">kubectl </span><span class="c0">wait</span><span class="c14">&nbsp;deployment 3scale-kourier-control 3scale-kourier-gateway --</span><span class="c14 c22">for</span><span class="c14 c34">=</span><span class="c14 c22">condition</span><span class="c14 c34">=</span><span class="c14">Available </span><span class="c14 c38">-n</span><span class="c14">&nbsp;kourier-system --</span><span class="c14 c22">timeout</span><span class="c14 c34">=</span><span class="c4 c14 c8">-1s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>Kind is running on your local machine, so the external IP address is your local host (</span><span class="c3">127.0.0.1</span><span class="c4 c10 c8">). You&rsquo;ll need that external IP address in other steps as well, so it&rsquo;s useful to export it to a variable.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.6336149e187baedc9dc8789b4f7f665ecd5ce4e5"></a><a id="t.12"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">export</span><span class="c14">&nbsp;</span><span class="c14 c22">EXTERNAL_IP</span><span class="c14 c34">=</span><span class="c14 c32">&quot;127.0.0.1&quot;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">nip.io is a dead simple wildcard DNS for any IP Address. nip.io allows you to do that by mapping any IP Address to a hostname, which means you can stop editing your etc/hosts file with custom hostname and IP address mappings. Using the external IP address, you can use nip.io to make sure any DNS query resolves to that IP address.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0aeadb27883869ff95422de72fce5fe82a16ef7b"></a><a id="t.13"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">export</span><span class="c14">&nbsp;</span><span class="c14 c22">KNATIVE_DOMAIN</span><span class="c14 c34">=</span><span class="c14 c32">&quot;</span><span class="c14 c22">$EXTERNAL_IP.nip.io</span><span class="c14 c32">&quot;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To validate it works properly, you can use the </span><span class="c3">dig</span><span class="c4 c10 c8">&nbsp;command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.23ed5145996048d0d7f6a333b178b269668ce9bc"></a><a id="t.14"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">dig </span><span class="c6">$KNATIVE_DOMAIN</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>Now you need to update the DNS settings for Knative to make sure that Knative knows about the DNS settings. To do that, you&rsquo;ll need to patch the </span><span class="c3">config-domain</span><span class="c4 c10 c8">&nbsp;config map.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.e36816443b9ea12f55323b9ebb9785a7bc1c66f5"></a><a id="t.15"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl patch configmap </span><span class="c15">-n</span><span class="c0">&nbsp;knative-serving config-domain </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c1">&quot;{</span><span class="c13">\&quot;</span><span class="c1">data</span><span class="c13">\&quot;</span><span class="c1">: {</span><span class="c13">\&quot;</span><span class="c6">$KNATIVE_DOMAIN</span><span class="c13">\&quot;</span><span class="c1">: </span><span class="c13">\&quot;\&quot;</span><span class="c1">}}&quot;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To validate that command was executed successfully, you can </span><span class="c3">describe</span><span class="c4 c10 c8">&nbsp;the config map.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.ce1141ec39baacbf697a853e29bdc295f3f4c590"></a><a id="t.16"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl describe configmap </span><span class="c15">-n</span><span class="c4 c0">&nbsp;knative-serving config-domain</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Now that the configuration is almost done, you&rsquo;ll need to configure Kourier to listen for http traffic on port 80 of the kind node and change the service type to NodePort instead of LoadBalancer.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.77a3b8796c5a71eda5c5cf768e8b3a0f60ee6bc6"></a><a id="t.17"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: v1</span></p><p class="c2"><span class="c1">kind: Service</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: kourier-ingress</span></p><p class="c2"><span class="c1">&nbsp; namespace: kourier-system</span></p><p class="c2"><span class="c1">&nbsp; labels:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; networking.knative.dev/ingress-provider: kourier</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; type: NodePort</span></p><p class="c2"><span class="c1">&nbsp; selector:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; app: 3scale-kourier-gateway</span></p><p class="c2"><span class="c1">&nbsp; ports:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: http2</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; nodePort: 31080</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; port: 80</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; targetPort: 8080</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The last step is to update the configuration of Knative to use Kourier.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.904519ffdf6abb925de24bdbcf97273d2764be3f"></a><a id="t.18"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl patch configmap </span><span class="c15">-n</span><span class="c0">&nbsp;knative-serving --type merge config-network </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c1">&#39;{&quot;data&quot;:{&quot;ingress.class&quot;:&quot;kourier.ingress.networking.knative.dev&quot;}}&#39;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To validate that command was executed successfully, you can </span><span class="c3">describe</span><span class="c4 c10 c8">&nbsp;the config map.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.3963c9ed33c5d458cb80ebbc5ed1265e33613d26"></a><a id="t.19"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl describe configmap </span><span class="c15">-n</span><span class="c4 c0">&nbsp;knative-serving config-network</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To make sure everything is okay, all pods should be in </span><span class="c3">Running</span><span>&nbsp;state and your </span><span class="c3">kourier-ingress</span><span class="c4 c10 c8">&nbsp;service configured.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.a4ea13f1cc47a9a64a9ad6ace1577321fd812b7f"></a><a id="t.20"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl get pods </span><span class="c15">-n</span><span class="c4 c0">&nbsp;knative-serving</span></p><p class="c2"><span class="c0">kubectl get pods </span><span class="c15">-n</span><span class="c4 c0">&nbsp;kourier-system</span></p><p class="c2"><span class="c0">kubectl get svc &nbsp;</span><span class="c15">-n</span><span class="c4 c0">&nbsp;kourier-system kourier-ingress</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.afx9frcstew3"><span class="c36 c8">Deploying your first app</span></h2><p class="c2"><span class="c4 c10 c8">You&rsquo;re now ready to deploy our first application, and play around with scaling to zero and traffic splitting (super useful if you want to do A/B testing or roll out features that shouldn&rsquo;t get traffic yet). To show these concepts you&rsquo;ll use the hello-world sample from Knative. For now, we&rsquo;ll set the autoscale window to 15 seconds, which means that the service is scaled to zero if no request was received during that time.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2c6f967f38f578a5535385dda1fd7a4b709173e3"></a><a id="t.21"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service create hello --image </span><span class="c26">gcr.io/knative-samples/helloworld-go</span><span class="c4 c0">&nbsp;--autoscale-window 15s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can check that the service was created with the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.9ea30755b4578a198320aa0d96de597ee1deb621"></a><a id="t.22"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">kn service list hello</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">In a separate terminal window, run the below command to see how the containers are created and terminated when you invoke your app.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0d12f39d150171fef88266f0c254293ab53ee652"></a><a id="t.23"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl get pod -l </span><span class="c26">serving.knative.dev/service</span><span class="c0">=hello </span><span class="c15">-w</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can call your app using the below curl command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b95be7be8f0350ede123ec86894845cda0a968a1"></a><a id="t.24"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//hello.default.127.0.0.1.nip.io</span></p></td></tr></tbody></table><h2 class="c20" id="h.opfl5uwkols1"><span class="c36 c8">Dynamic scaling</span></h2><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.d3cd1912b459b763e4f495ef83d1b0be41754eec"></a><a id="t.25"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image3.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c31">Using your favorite load testing tool, try to send as much traffic as you can to that URL to see the dynamic scaling in action.</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.lz27inrumrqf"><span class="c36 c8">Updating your app</span></h2><p class="c2"><span>Saying hello to the world is nice, but saying it to the rest of the SpringOne conference is even better &#x1f609; Let&rsquo;s update the environment variable </span><span class="c3">TARGET</span><span class="c4 c10 c8">&nbsp;with a new message.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.352e8029632475563057d2c0180a94ffd8d5dbb5"></a><a id="t.26"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service update hello --env </span><span class="c6">TARGET</span><span class="c21">=</span><span class="c1 c4">&quot;SpringOne!&quot;</span></p><p class="c2 c9"><span class="c1 c4"></span></p><p class="c2"><span class="c14 c8 c37">Note: if you&rsquo;re using zsh as your terminal you might need to escape the exclamation point (\!)</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can call your app using the same URL and see a different message</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b95be7be8f0350ede123ec86894845cda0a968a1"></a><a id="t.27"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//hello.default.127.0.0.1.nip.io</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.5md27e6zqaph"><span class="c36 c8">Viewing resources</span></h2><p class="c2"><span>Within Octant you can see all revisions under &ldquo;</span><span class="c3">custom resources -&gt; revisions.serving.knative.dev</span><span>&rdquo;. From a Knative point of view, these resources are immutable so you cannot make any changes. It does however, give you an amazing overview of all the Kubernetes objects that are created when you run the </span><span class="c3">kn service create</span><span class="c4 c10 c8">&nbsp;command.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 324.00px;"><img alt="" src="images/image7.png" style="width: 624.00px; height: 324.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can create new services using the Octant UI as well. Click on &ldquo;</span><span class="c3">Apply YAML</span><span class="c4 c10 c8">&rdquo; in the top right corner and paste the below snippet. After that, hit apply to create a new Knative service.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0de82fd0b314f282ecc166a60b08086a814f95fd"></a><a id="t.28"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c18">apiVersion:</span><span class="c0">&nbsp;serving</span><span class="c21">.</span><span class="c0">knative</span><span class="c21">.</span><span class="c0">dev</span><span class="c21">/</span><span class="c4 c0">v1</span></p><p class="c2"><span class="c18">kind:</span><span class="c4 c0">&nbsp;Service</span></p><p class="c2"><span class="c18">metadata:</span></p><p class="c2"><span class="c18">&nbsp; name:</span><span class="c0">&nbsp;octant</span><span class="c21">-</span><span class="c4 c0">knative</span></p><p class="c2"><span class="c18">&nbsp; namespace:</span><span class="c0">&nbsp;</span><span class="c19">default</span></p><p class="c2"><span class="c18">spec:</span></p><p class="c2"><span class="c18">&nbsp; template:</span></p><p class="c2"><span class="c18">&nbsp; &nbsp; spec:</span></p><p class="c2"><span class="c18">&nbsp; &nbsp; &nbsp; containers:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c21">-</span><span class="c0">&nbsp;image</span><span class="c28 c24">:</span><span class="c0">&nbsp;gcr</span><span class="c21">.</span><span class="c0">io</span><span class="c21">/</span><span class="c0">knative</span><span class="c21">-</span><span class="c0">samples</span><span class="c21">/</span><span class="c0">helloworld</span><span class="c21">-</span><span class="c4 c0">go</span></p><p class="c2"><span class="c18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; env:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c21">-</span><span class="c0">&nbsp;name</span><span class="c28 c24">:</span><span class="c4 c0">&nbsp;TARGET</span></p><p class="c2"><span class="c18">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value:</span><span class="c0">&nbsp;</span><span class="c19">&quot;</span><span class="c1">Octant</span><span class="c19">&quot;</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2 c9"><span class="c4 c0"></span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can call your app using the same URL and see a different message</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.340d4967c3c4f09c8994fa73e2b37a98e96813d4"></a><a id="t.29"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//octant-knative.default.127.0.0.1.nip.io</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.hhtz4mxnst3k"><span class="c36 c8">Splitting traffic</span></h2><p class="c2"><span class="c4 c10 c8">But what if you&rsquo;re not entirely sure that this is the right message? That&rsquo;s where A_B testing comes in. A/B testing (also known as bucket testing or split-run testing) is a user experience research methodology. A/B tests consist of a randomized experiment with two variants, A and B. To do that, we can split the traffic between the first version of the service (which said hello to the world) and the second one (which said hello to SpringOne)</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>First, you&rsquo;ll need to </span><span class="c3">tag</span><span class="c4 c10 c8">&nbsp;the first version of the service. You can get a list of all revisions (versions) with the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.30ac7e3ede984d932cdb98e625f3ea64985b6d13"></a><a id="t.30"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">kn revision list</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The first version, which will be on the bottom of the list (with no value in the traffic column) is the first version. To tag that one, run the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.9cc46833d2cb809017816bc484824b095bc0f095"></a><a id="t.31"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service update hello --tag </span><span class="c18">&lt;</span><span class="c0">revision name</span><span class="c18">&gt;</span><span class="c4 c0">=v1</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To set up traffic splitting between the tagged V1 version and the latest version (for a </span><span class="c3">75/25</span><span class="c4 c10 c8">&nbsp;split), you can run the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.db319a1e37820c9d16730beb5c1900966d05e86c"></a><a id="t.32"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service update hello --traffic </span><span class="c6">v1</span><span class="c21">=</span><span class="c25">75</span><span class="c0">,@</span><span class="c6">latest</span><span class="c21">=</span><span class="c25">25</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The commands </span><span class="c3">kn revision list</span><span>&nbsp;and </span><span class="c3">kn service describe hello</span><span class="c4 c10 c8">&nbsp;should now show you a split in traffic. To see that in action, run the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.61d3e3687565bce1312e3294fcb6684f66a6d9b0"></a><a id="t.33"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c19">while</span><span class="c0">&nbsp;</span><span class="c15">true</span><span class="c24 c28">;</span><span class="c0">&nbsp;</span><span class="c19">do</span></p><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//hello.default.127.0.0.1.nip.io</span></p><p class="c2"><span class="c0">sleep </span><span class="c25">0</span><span class="c19">.</span><span class="c25">5</span></p><p class="c2"><span class="c19">done</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.15170227f771c048cccaa9a2b1c44a4a867432c3"></a><a id="t.34"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image3.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c31">You can try setting different percentages to see the changes in the response to the above command.</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">This is great! Now let&rsquo;s prepare for VMworld 2020, next month&hellip; The new version should be ready and testable, though you don&rsquo;t want to expose this version to everyone just yet. To do that, you&rsquo;ll have to create a new revision and split traffic accordingly.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You&rsquo;ll need to tag the current version (V2) first</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.94d9cf5799f5e9562604c3eedfd94f685a994a6f"></a><a id="t.35"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service update hello --tag </span><span class="c28 c24">$(</span><span class="c0">kubectl get ksvc hello --</span><span class="c6">template</span><span class="c21">=</span><span class="c1">&#39;{{.status.latestReadyRevisionName}}&#39;</span><span class="c28 c24">)</span><span class="c0">=v2</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Now, let&rsquo;s create a new version for VMworld 2020, tag it with V3 (you&rsquo;ll see why in just a second) and split traffic so that it doesn&rsquo;t get any traffic at all.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.479ed8a9a9c7513e7618f81fcc9eb7ef9cc89633"></a><a id="t.36"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c19">kn service update hello --env </span><span class="c6">TARGET</span><span class="c21">=</span><span class="c1">&quot;VMworld 2020!&quot;</span><span class="c19">&nbsp;--tag @</span><span class="c6">latest</span><span class="c21">=</span><span class="c19">v3 --traffic </span><span class="c6">v1</span><span class="c21">=</span><span class="c25">75</span><span class="c19">,</span><span class="c6">v2</span><span class="c21">=</span><span class="c25">25</span><span class="c19">,@</span><span class="c6">latest</span><span class="c21">=</span><span class="c25">0</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The commands </span><span class="c3">kn revision list</span><span>&nbsp;and </span><span class="c3">kn service describe hello</span><span class="c4 c10 c8">&nbsp;should show you the same split in traffic as before (and also show the new version getting no traffic). If you want to try it out, you can use the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.61d3e3687565bce1312e3294fcb6684f66a6d9b0"></a><a id="t.37"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c19">while</span><span class="c0">&nbsp;</span><span class="c15">true</span><span class="c28 c24">;</span><span class="c0">&nbsp;</span><span class="c19">do</span></p><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//hello.default.127.0.0.1.nip.io</span></p><p class="c2"><span class="c0">sleep </span><span class="c25">0</span><span class="c19">.</span><span class="c25">5</span></p><p class="c2"><span class="c19">done</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can access specific versions of the service with </span><span class="c3">http://&lt;tag&gt;-hello.default.127.0.0.1.nip.io</span><span class="c4 c10 c8">. So even though V3 of the service isn&rsquo;t getting any traffic you can send it a request with the below curl command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.7081a9b9b2d174c60a86380bfd0af3b6937981dc"></a><a id="t.38"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//v3-hello.default.127.0.0.1.nip.io</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Now let&rsquo;s assume that we&rsquo;re at VMworld 2020 and need to get this version of the service live and direct all traffic here. You can do that with the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.667437a89759a18c96975d738c2091695461ee61"></a><a id="t.39"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service update hello --traffic @</span><span class="c6">latest</span><span class="c21">=</span><span class="c25">100</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The commands </span><span class="c3">kn revision list</span><span>&nbsp;and </span><span class="c3">kn service describe hello</span><span class="c4 c10 c8">&nbsp;should now show you that all traffic is sent to version 3. If you want to try it out, you can use the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.61d3e3687565bce1312e3294fcb6684f66a6d9b0"></a><a id="t.40"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c19">while</span><span class="c0">&nbsp;</span><span class="c15">true</span><span class="c28 c24">;</span><span class="c0">&nbsp;</span><span class="c19">do</span></p><p class="c2"><span class="c0">curl http</span><span class="c21">:</span><span class="c26">//hello.default.127.0.0.1.nip.io</span></p><p class="c2"><span class="c0">sleep </span><span class="c25">0</span><span class="c19">.</span><span class="c25">5</span></p><p class="c2"><span class="c19">done</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can still access the older versions with </span><span class="c3">curl http://v1-hello.default.127.0.0.1.nip.io</span><span>&nbsp;or &nbsp;</span><span class="c4 c3 c8">curl http://v2-hello.default.127.0.0.1.nip.io</span></p><p class="c2 c9"><span class="c4 c3 c8"></span></p><p class="c2"><span>To get a complete YAML overview of everything that you&rsquo;ve done so far, you can use the experimental </span><span class="c3">export --with-revisions</span><span class="c4 c10 c8">&nbsp;command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.29e44e7ab8309c8528f0639d8dd1c87f3a697319"></a><a id="t.41"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service export hello --with-revisions --</span><span class="c6">mode</span><span class="c21">=</span><span class="c0">export </span><span class="c15">-o</span><span class="c4 c0">&nbsp;yaml</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h1 class="c33 c45" id="h.geneo0sqcdmo"><span class="c12 c8"></span></h1><h1 class="c33" id="h.bu6udzyuqjzr"><span class="c12 c8">Tekton</span></h1><h2 class="c20" id="h.aw04eqbvb4hc"><span class="c36 c8">Install Tekton</span></h2><p class="c2"><span>So far you&rsquo;ve done a lot manually. Let&rsquo;s go and automate some of this! Tekton is a powerful yet flexible Kubernetes-native open-source framework for creating continuous integration and delivery (CI/CD) systems. It lets you build, test, and deploy across multiple cloud providers or on-premises systems by abstracting away the underlying implementation details. You&rsquo;ll need to install Tekton in the namespace </span><span class="c3">tekton-pipelines</span><span class="c4 c10 c8">.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.e4d9ec162400f01ecad5ac0d06cbc749a2c31747"></a><a id="t.42"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl apply </span><span class="c15">-f</span><span class="c0">&nbsp;https</span><span class="c21">:</span><span class="c26">//github.com/tektoncd/pipeline/releases/download/v0.14.1/release.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">kubectl wait deployment tekton-pipelines-controller tekton-pipelines-webhook --</span><span class="c6">for</span><span class="c21">=</span><span class="c6">condition</span><span class="c21">=</span><span class="c0">Available </span><span class="c15">-n</span><span class="c4 c0">&nbsp;tekton-pipelines</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Some cool features of Tekton include that Tekton Pipelines are Cloud Native:</span></p><ul class="c46 lst-kix_vuc3fiwbn0el-0 start"><li class="c2 c30"><span class="c4 c10 c8">Run on Kubernetes</span></li><li class="c2 c30"><span class="c4 c10 c8">Have Kubernetes clusters as a first class type</span></li><li class="c2 c30"><span class="c4 c10 c8">Use containers as their building blocks</span></li></ul><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Tekton Pipelines are Decoupled:</span></p><ul class="c46 lst-kix_4p3a64mz17zi-0 start"><li class="c2 c30"><span class="c4 c10 c8">One Pipeline can be used to deploy to any k8s cluster</span></li><li class="c2 c30"><span class="c4 c10 c8">The Tasks which make up a Pipeline can easily be run in isolation</span></li><li class="c2 c30"><span class="c4 c10 c8">Resources such as git repos can easily be swapped between runs</span></li></ul><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">To get some visibility into what Tekton is doing, you can install the Tekton dashboard too.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.9ecbea61f0fe4536e0496a425ba5ff6216ce107e"></a><a id="t.43"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl apply </span><span class="c15">-f</span><span class="c0">&nbsp;https</span><span class="c21">:</span><span class="c26">//github.com/tektoncd/dashboard/releases/download/v0.7.1/tekton-dashboard-release.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">kubectl wait deployment tekton-dashboard --</span><span class="c6">for</span><span class="c21">=</span><span class="c6">condition</span><span class="c21">=</span><span class="c0">Available </span><span class="c15">-n</span><span class="c4 c0">&nbsp;tekton-pipelines</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can use Kourier to make the dashboard accessible to your host on the URL http://dashboard.tekton-pipelines.127.0.0.1.nip.io. If you want a different URL, you can change the &ldquo;</span><span class="c3">hosts</span><span class="c4 c10 c8">&rdquo; element in the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.617727df98026f942c477b578eb15ac444f45d0a"></a><a id="t.44"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: networking.internal.knative.dev/v1alpha1</span></p><p class="c2"><span class="c1">kind: Ingress</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: tekton-dashboard</span></p><p class="c2"><span class="c1">&nbsp; namespace: tekton-pipelines</span></p><p class="c2"><span class="c1">&nbsp; annotations:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; networking.knative.dev/ingress.class: kourier.ingress.networking.knative.dev</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; rules:</span></p><p class="c2"><span class="c1">&nbsp; - hosts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - dashboard.tekton-pipelines.$KNATIVE_DOMAIN</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; http:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; paths:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - splits:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - appendHeaders: {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; serviceName: tekton-dashboard</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; serviceNamespace: tekton-pipelines</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; servicePort: 9097</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; visibility: ExternalIP</span></p><p class="c2"><span class="c1">&nbsp; visibility: ExternalIP</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.n4re0d2lzl68"><span class="c36 c8">Setting up your container registry</span></h2><p class="c2"><span>To publish container images you&rsquo;ll need to have access to a registry. In this workshop you&rsquo;ll use Docker Hub, but you can replace that with a different registry if you want as well. You&rsquo;ll use a Kubernetes secret of type </span><span class="c3">docker-registry</span><span>&nbsp;with the name </span><span class="c3">dockercreds</span><span class="c4 c10 c8">.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0470777947e8a5ef739ef2d883ae7294dc07ba6c"></a><a id="t.45"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl create secret docker-registry dockercreds --</span><span class="c6">docker-server</span><span class="c21">=</span><span class="c1">&quot;docker.io&quot;</span><span class="c0">&nbsp;--</span><span class="c6">docker-username</span><span class="c21">=</span><span class="c1">&quot;&lt;your name&gt;&quot;</span><span class="c0">&nbsp;--</span><span class="c6">docker-password</span><span class="c21">=</span><span class="c1">&quot;&lt;your password&gt;&quot;</span><span class="c4 c0">&nbsp;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can see the result of the command with </span><span class="c3">kubectl describe secret dockercreds</span><span class="c4 c10 c8">.</span></p><p class="c2"><span class="c4 c10 c8">If you want to do this manually, you can use the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.38db4bc8bcde701832e9fffb8643f8d23f5616f5"></a><a id="t.46"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">export </span><span class="c6">USERNAME</span><span class="c21">=</span><span class="c29">`echo </span><span class="c41 c38">-n</span><span class="c29">&nbsp;</span><span class="c32 c41">&quot;&lt;your docker username&gt;&quot;</span><span class="c29">&nbsp;</span><span class="c41 c40">|</span><span class="c29">&nbsp;base64`</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">export </span><span class="c6">PASSWORD</span><span class="c21">=</span><span class="c29">`echo </span><span class="c41 c38">-n</span><span class="c29">&nbsp;</span><span class="c41 c32">&quot;&lt;your docker password&gt;&quot;</span><span class="c29">&nbsp;</span><span class="c41 c40">|</span><span class="c29">&nbsp;base64`</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: v1</span></p><p class="c2"><span class="c1">kind: Secret</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: dockercreds</span></p><p class="c2"><span class="c1">&nbsp; annotations:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; tekton.dev/docker-0: https://index.docker.io/v1/</span></p><p class="c2"><span class="c1">type: kubernetes.io/basic-auth</span></p><p class="c2"><span class="c1">data:</span></p><p class="c2"><span class="c1">&nbsp; # Use &#39;echo -n &quot;username&quot; | base64&#39; to generate this string</span></p><p class="c2"><span class="c1">&nbsp; username: $USERNAME</span></p><p class="c2"><span class="c1">&nbsp; # Use &#39;echo -n &quot;password&quot; | base64&#39; to generate this string</span></p><p class="c2"><span class="c1">&nbsp; password: $PASSWORD</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The next step is to create a Kubernetes ServiceAccount that will have access to the secret so it can publish images.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.e86165309c6ae456614ee0b0c7fde272749019a1"></a><a id="t.47"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: v1</span></p><p class="c2"><span class="c1">kind: ServiceAccount</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: pipeline</span></p><p class="c2"><span class="c1">secrets:</span></p><p class="c2"><span class="c1">&nbsp; - name: dockercreds</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The command </span><span class="c3">kubectl describe serviceaccount pipelin</span><span>` shows all configured items for the service account, including that it has access to a </span><span class="c43">Mountable Secret</span><span>&nbsp;called dockercreds. To make sure the ServiceAccount has the right RBAC permissions to deploy services to the namespace </span><span class="c3">default</span><span class="c4 c10 c8">, you&rsquo;ll have to set up the correct permissions.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c43">This command is split over two pages...</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.51c0984fd2bda509ab03e5e4fa11a07d3f3390ea"></a><a id="t.48"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">---</span></p><p class="c2"><span class="c1">apiVersion: rbac.authorization.k8s.io/v1</span></p><p class="c2"><span class="c1">kind: Role</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: pipeline</span></p><p class="c2"><span class="c1">&nbsp; namespace: default</span></p><p class="c2"><span class="c1">rules:</span></p><p class="c2"><span class="c1">&nbsp; - apiGroups:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - serving.knative.dev</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; resources:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - &quot;*&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; verbs:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - create</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - update</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - patch</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - delete</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - get</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - list</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - watch</span></p><p class="c2"><span class="c1">&nbsp; - apiGroups:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - &quot;&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; resources:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - configmaps</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; verbs:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - get</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - list</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - watch</span></p><p class="c2"><span class="c1">&nbsp; - apiGroups:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - triggers.tekton.dev</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; resources:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - &quot;*&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; verbs:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - create</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - update</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - patch</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - delete</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - get</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - list</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - watch</span></p><p class="c2"><span class="c1">&nbsp; - apiGroups:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - tekton.dev</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; resources:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - &quot;*&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; verbs:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - create</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - update</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - patch</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - delete</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - get</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - list</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - watch</span></p><p class="c2"><span class="c1">---</span></p><p class="c2"><span class="c1">apiVersion: rbac.authorization.k8s.io/v1</span></p><p class="c2"><span class="c1">kind: RoleBinding</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: pipeline</span></p><p class="c2"><span class="c1">&nbsp; namespace: default</span></p><p class="c2"><span class="c1">subjects:</span></p><p class="c2"><span class="c1">&nbsp; - kind: ServiceAccount</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; name: pipeline</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; namespace: default</span></p><p class="c2"><span class="c1">roleRef:</span></p><p class="c2"><span class="c1">&nbsp; kind: Role</span></p><p class="c2"><span class="c1">&nbsp; name: pipeline</span></p><p class="c2"><span class="c1">&nbsp; apiGroup: rbac.authorization.k8s.io</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h2 class="c20 c35" id="h.i62o9ttvvc32"><span class="c36 c8"></span></h2><h2 class="c20" id="h.qan937b0qkw5"><span class="c36 c8">Building a Tekton task</span></h2><p class="c2"><span class="c4 c10 c8">You&rsquo;ll incrementally build up the Tekton Task that builds the image and try it out every time to see the results. The first step is to clone the source code.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2c068f746f81b9264c14907d4796989dbdeb286e"></a><a id="t.49"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Task</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: build</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The branch, tag, or git reference from the git repo-url location</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: master</span></p><p class="c2"><span class="c1">&nbsp; steps:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: git-clone</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: alpine/git</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git clone </span><span class="c13">\$</span><span class="c1">(params.repo-url) /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cd /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git checkout </span><span class="c13">\$</span><span class="c1">(params.revision)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; volumes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can get a detailed overview of the data in the task with </span><span class="c3">tkn task ls</span><span>&nbsp;and </span><span class="c3">tkn task describe build</span><span class="c4 c10 c8">. You can also view the task in the Tekton dashboard.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.a23bb842807fbafc1a10e7f5a17bf2da28bcd5c0"></a><a id="t.50"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c51"><span class="c4 c31 c8">For the source code, you can use an existing repository https://github.com/retgits/simple-node-app, or you can make a fork of that repository to use. If you&rsquo;re using your own forked version, make sure you update the URLs in the snippets accordingly.</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>Let&rsquo;s use the Tekton CLI to test the task. You&rsquo;ll need to pass the ServiceAccount </span><span class="c3">pipeline</span><span class="c4 c10 c8">&nbsp;to be used to run the Task and you&rsquo;ll need to pass in the URL to a GitHub repo you want to use.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b2a66e62b9b3db7a51d23570b48ab2f9d3290c98"></a><a id="t.51"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">tkn task start build --showlog </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">repo-url</span><span class="c21">=</span><span class="c0">https</span><span class="c21">:</span><span class="c26">//github.com/retgits/simple-node-app</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-s</span><span class="c4 c0">&nbsp;pipeline </span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Next, you&rsquo;ll add the build step that builds a docker image and pushes it to DockerHub. This command is split over two pages...</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2a61fbc66690aa5201eeb8b3888cfcb20574ecee"></a><a id="t.52"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Task</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: build</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The branch, tag, or git reference from the git repo-url location</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: master</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name (reference) of the image to build.</span></p><p class="c2"><span class="c1">&nbsp; steps:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: git-clone</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: alpine/git</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git clone </span><span class="c13">\$</span><span class="c1">(params.repo-url) /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cd /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git checkout </span><span class="c13">\$</span><span class="c1">(params.revision)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: build-image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: quay.io/buildah/stable:v1.14.8</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; workingdir: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;Building Image </span><span class="c13">\$</span><span class="c1">(params.image)&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; buildah --storage-driver=overlay bud --format=docker --tls-verify=false -f ./Dockerfile -t </span><span class="c13">\$</span><span class="c1">(params.image) .</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;Pushing Image </span><span class="c13">\$</span><span class="c1">(params.image)&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; buildah &nbsp;--storage-driver=overlay push --tls-verify=false --digestfile ./image-digest </span><span class="c13">\$</span><span class="c1">(params.image) docker://</span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; securityContext:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; privileged: true</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: varlibcontainers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /var/lib/containers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; volumes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: varlibcontainers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can get a detailed overview of the data in the task with </span><span class="c3">tkn task ls</span><span>&nbsp;and </span><span class="c3">tkn task describe build</span><span class="c4 c10 c8">. You can also view the task in the Tekton dashboard.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>Let&rsquo;s use the Tekton CLI to test the task. You&rsquo;ll need to pass the ServiceAccount </span><span class="c3">pipeline</span><span class="c4 c10 c8">&nbsp;to be used to run the Task and you&rsquo;ll need to pass in the URL to a GitHub repo you want to use.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.1cf9ba280b791636e6865bdcee51ff90e4076ff6"></a><a id="t.53"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">tkn task start build --showlog </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">repo-url</span><span class="c21">=</span><span class="c0">https</span><span class="c21">:</span><span class="c26">//github.com/retgits/simple-node-app</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">image</span><span class="c21">=</span><span class="c26">docker.io/&lt;your dockerhub username&gt;/springoneapp</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-s</span><span class="c4 c0">&nbsp;pipeline</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Now you&rsquo;ve built an image, but it isn&rsquo;t deployed yet. Let&rsquo;s do that next. This command is split over two pages...</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.47a46f9d11b28f07f9fbb59a9e5fdfdb5339a6e3"></a><a id="t.54"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Task</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: build</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The branch, tag, or git reference from the git repo-url location</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: master</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name (reference) of the image to build.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name of the service to deploy</span></p><p class="c2"><span class="c1">&nbsp; steps:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: git-clone</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: alpine/git</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git clone </span><span class="c13">\$</span><span class="c1">(params.repo-url) /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cd /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git checkout </span><span class="c13">\$</span><span class="c1">(params.revision)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: build-image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: quay.io/buildah/stable:v1.14.8</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; workingdir: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;Building Image </span><span class="c13">\$</span><span class="c1">(params.image)&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; buildah --storage-driver=overlay bud --format=docker --tls-verify=false -f ./Dockerfile -t </span><span class="c13">\$</span><span class="c1">(params.image) .</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;Pushing Image </span><span class="c13">\$</span><span class="c1">(params.image)&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; buildah &nbsp;--storage-driver=overlay push --tls-verify=false --digestfile ./image-digest </span><span class="c13">\$</span><span class="c1">(params.image) docker://</span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; securityContext:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; privileged: true</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: varlibcontainers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /var/lib/containers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: kn-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: gcr.io/knative-releases/knative.dev/client/cmd/kn:latest</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; args:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - create</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - --force</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - </span><span class="c13">\$</span><span class="c1">(params.service)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - --image=</span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; volumes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: varlibcontainers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2"><span>You can get a detailed overview of the data in the task with </span><span class="c3">tkn task ls</span><span>&nbsp;and </span><span class="c3">tkn task describe build</span><span class="c4 c10 c8">. You can also view the task in the Tekton dashboard.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Let&rsquo;s use the Tekton CLI to test the task. In addition to the parameters from the last run, you&rsquo;ll also need to pass in the name of the service to create.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.4ef66cd56e58b67f3ca2708523ca83b16475f866"></a><a id="t.55"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">tkn task start build --showlog </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">repo-url</span><span class="c21">=</span><span class="c0">https</span><span class="c21">:</span><span class="c26">//github.com/retgits/simple-node-app</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">image</span><span class="c21">=</span><span class="c26">docker.io/&lt;your dockerhub username&gt;/springoneapp</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">service</span><span class="c21">=</span><span class="c0">springoneapp </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-s</span><span class="c4 c0">&nbsp;pipeline </span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>When you&rsquo;re running these commands, you can also view the logs in the Tekton dashboard on `</span><span class="c3">http://dashboard.tekton-pipelines.127.0.0.1.nip.io</span><span class="c4 c10 c8">`</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>This is great! Your service is now deployed on Knative and ready to accept traffic. You can view the service with `</span><span class="c3">kn service list</span><span>` and you can access the app with curl `</span><span class="c3">curl http://springoneapp.default.127.0.0.1.nip.io</span><span class="c4 c10 c8">`</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.f1b93a0f660f52c7deeafff02d443161e4cb91f7"></a><a id="t.56"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image3.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c31">In exploring Knative services, you used an environment variable to change the message. Can you add that variable in the Tekton task too?</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.fde4ada36918da721652d815c2f2dd8531b6ef52"></a><a id="t.57"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image3.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c31">When you have multiple versions (revisions) of the service, how can you extend this pipeline to split traffic?</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h2 class="c20 c35" id="h.67t9ge4kveni"><span class="c36 c8"></span></h2><h2 class="c20" id="h.qdlt9sunz4st"><span class="c36 c8">Setting up pipelines</span></h2><p class="c2"><span>The current task is quite large. It has 4 steps that essentially do two things, build an image and deploy it as a Knative service. In this section you&rsquo;ll break up the Task into two smaller tasks, create a pipeline to combine them, and run the pipeline. As you&rsquo;re running these commands, know that you can also view the logs in the Tekton dashboard on </span><span class="c4 c3 c8">http://dashboard.tekton-pipelines.127.0.0.1.nip.io</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">This command is split over two pages&hellip;</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2e8a2b33cff24981c25a86218cc633e001c05416"></a><a id="t.58"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Task</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: git-build</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The branch, tag, or git reference from the git repo-url location</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: master</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name (reference) of the image to build.</span></p><p class="c2"><span class="c1">&nbsp; steps:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: git-clone</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: alpine/git</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git clone </span><span class="c13">\$</span><span class="c1">(params.repo-url) /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; cd /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; git checkout </span><span class="c13">\$</span><span class="c1">(params.revision)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: build-image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: quay.io/buildah/stable:v1.14.8</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; workingdir: /source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; script: |</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;Building Image </span><span class="c13">\$</span><span class="c1">(params.image)&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; buildah --storage-driver=overlay bud --format=docker --tls-verify=false -f ./Dockerfile -t </span><span class="c13">\$</span><span class="c1">(params.image) .</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;Pushing Image </span><span class="c13">\$</span><span class="c1">(params.image)&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; buildah &nbsp;--storage-driver=overlay push --tls-verify=false --digestfile ./image-digest </span><span class="c13">\$</span><span class="c1">(params.image) docker://</span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; securityContext:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; privileged: true</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; volumeMounts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: varlibcontainers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /var/lib/containers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mountPath: /source</span></p><p class="c2"><span class="c1">&nbsp; volumes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: varlibcontainers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: source</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; emptyDir: {}</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can get a detailed overview of the data in the task with </span><span class="c3">tkn task ls</span><span>&nbsp;and </span><span class="c3">tkn task describe git-build</span><span class="c4 c10 c8">. You can also view the task in the Tekton dashboard.</span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.5e6beed9457375a4e9e98b14fcd330770ddfae40"></a><a id="t.59"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Task</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: ksvc-deploy</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name (reference) of the image to build.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name of the service to deploy</span></p><p class="c2"><span class="c1">&nbsp; results:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: URL of the Knative service deployed</span></p><p class="c2"><span class="c1">&nbsp; steps:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: kn-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: gcr.io/knative-releases/knative.dev/client/cmd/kn:latest</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; args:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - create</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - --force</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - </span><span class="c13">\$</span><span class="c1">(params.service)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - --image=</span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: kn-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; image: gcr.io/knative-releases/knative.dev/client/cmd/kn:latest</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; args:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - describe</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - </span><span class="c13">\$</span><span class="c1">(params.service)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - --output=jsonpath={.status.url} &gt; /tekton/results/url</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can get a detailed overview of the data in the task with </span><span class="c3">tkn task ls</span><span>&nbsp;and </span><span class="c3">tkn task describe ksvc-deploy</span><span>. You can also view the task in the Tekton dashboard. The </span><span class="c3">ksvc-deploy</span><span class="c4 c10 c8">&nbsp;task can also be used to deploy any other container as a Knative service.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.41730adb73aaf8259fe24ee02862018543a198d5"></a><a id="t.60"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">tkn task start ksvc-deploy --showlog </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">image</span><span class="c21">=</span><span class="c26">gcr.io/knative-samples/helloworld-go</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">service</span><span class="c21">=</span><span class="c0">helloworld </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-s</span><span class="c4 c0">&nbsp;pipeline </span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Now for the Tekton pipeline</span></p><a id="t.54162530cf51c8efbc9e40209f4a57f22fdb6055"></a><a id="t.61"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Pipeline</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: build-and-deploy</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The branch, tag, or git reference from the git repo-url location</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: master</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name (reference) of the image to build.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name of the service to deploy</span></p><p class="c2"><span class="c1">&nbsp; results:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: URL of the Knative service deployed</span></p><p class="c2"><span class="c1">&nbsp; tasks:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: git-build</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; taskRef:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; name: git-build</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.repo-url)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.revision)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: ksvc-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; runAfter: [git-build]</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; taskRef:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; name: ksvc-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - name: service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.service)</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>This time you can view the result with </span><span class="c3">tkn pipeline ls</span><span>&nbsp;and </span><span class="c3">tkn pipeline describe build-and-deploy</span><span class="c4 c10 c8">. As always, the results are also available in the Tekton dashboard.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Now you get to test it out, using the Tekton CIL you can run this pipeline just like the tasks earlier.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.877bba982e35ad0e47065000b4e06d7104e90231"></a><a id="t.62"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">tkn pipeline start build-and-deploy --showlog </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">repo-url</span><span class="c21">=</span><span class="c0">https</span><span class="c21">:</span><span class="c26">//github.com/retgits/simple-node-app</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">image</span><span class="c21">=</span><span class="c26">docker.io/&lt;your dockerhub username&gt;/springoneapp</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c6">service</span><span class="c21">=</span><span class="c0">springoneapp </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; </span><span class="c15">-s</span><span class="c4 c0">&nbsp;pipeline</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You&rsquo;ll see that the output now has the name of the Pipeline step and the Task step. Within the Tekton dashboard, you can see the pipeline in the </span><span class="c3">PipelineRuns</span><span>&nbsp;section. The individual tasks are still viewable in the </span><span class="c3">TaskRuns</span><span class="c4 c10 c8">&nbsp;section.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">In the terminal, you can get a full overview of the pipeline run as well with the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.6e938d77ff9b3f1e8837632f6ee4dfd79c66f5bd"></a><a id="t.63"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">tkn pipelinerun describe --last</span></p></td></tr></tbody></table><h2 class="c20" id="h.ns3bzsru0ddz"><span class="c36 c8">Add Tekton triggers</span></h2><p class="c2"><span class="c4 c10 c8">To make this a more evented flow, you can use the web hook trigger. You&rsquo;ll trigger the web hook manually at the end since everything is running on your own machine.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The first step is to install the Tekton Triggers.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.ffb41a6fa6dd6d02b0bc1c889cdf0971357461b3"></a><a id="t.64"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl apply </span><span class="c15">-f</span><span class="c0">&nbsp;https</span><span class="c21">:</span><span class="c26">//github.com/tektoncd/triggers/releases/download/v0.6.1/release.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">kubectl wait deployment tekton-triggers-controller tekton-triggers-webhook --</span><span class="c6">for</span><span class="c21">=</span><span class="c6">condition</span><span class="c21">=</span><span class="c0">Available </span><span class="c15">-n</span><span class="c4 c0">&nbsp;tekton-pipelines</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">When a message for your web hook arrives, it should start a pipeline. You&rsquo;ll need to create a trigger template to instruct Tekton to create a PipelineRun. Make sure that you update the default image name before applying the YAML.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.15e0c178cf86addd89f11f03e4f089b137253773"></a><a id="t.65"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: triggers.tekton.dev/v1alpha1</span></p><p class="c2"><span class="c1">kind: TriggerTemplate</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: build-and-deploy</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git revision.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: master</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository url.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-name</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: The git repository name.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; description: Name (reference) of the image to build.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; default: docker.io/retgits/springoneapp</span></p><p class="c2"><span class="c1">&nbsp; resourcetemplates:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - apiVersion: tekton.dev/v1beta1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: PipelineRun</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; metadata:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; generateName: build-and-deploy-run</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; spec:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; serviceAccountName: pipeline</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; pipelineRef:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: build-and-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.revision)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.repo-url)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: image</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.image)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(params.repo-name)</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">When the Webhook invokes we want to extract information from the Web Hook http request sent by the Git Server, we will use a TriggerBinding this information is what gets passed to the TriggerTemplate.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.3506b165a19064490f0799ff5f39741658d713e9"></a><a id="t.66"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: triggers.tekton.dev/v1alpha1</span></p><p class="c2"><span class="c1">kind: TriggerBinding</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: build-and-deploy</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; params:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: revision</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(body.head_commit.id)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-url</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(body.repository.url)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: repo-name</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; value: </span><span class="c13">\$</span><span class="c1">(body.repository.name)</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To be able to handle the http request sent by the GitHub Webhook, we need a webserver. Tekton provides a way to define this listeners that takes the TriggerBinding and the TriggerTemplate as specification. We can specify Interceptors to handle any customization for example I only want to start a new </span><span class="c3">Pipeline</span><span class="c4 c10 c8">&nbsp;only when push happens on the main branch.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.31d64961e39357b8294ea5db092473d36d8df995"></a><a id="t.67"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: triggers.tekton.dev/v1alpha1</span></p><p class="c2"><span class="c1">kind: EventListener</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: cicd</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; serviceAccountName: pipeline</span></p><p class="c2"><span class="c1">&nbsp; triggers:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - name: cicd-trigger</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; bindings:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - ref: build-and-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; template:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; name: build-and-deploy</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; interceptors:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - cel:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; filter: &quot;header.match(&#39;X-GitHub-Event&#39;, &#39;push&#39;) &amp;&amp; body.ref == &#39;refs/heads/master&#39;&quot;</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The Eventlister creates a deployment and a service you can list both using this command </span><span class="c3">kubectl get deployments,eventlistener,svc -l eventlistener=cicd</span><span>. The deployment should show </span><span class="c3">READY 1/1</span><span class="c4 c10 c8">&nbsp;before you can continue with the rest of this exercise.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.1ed0932833d341143e5d78c10f29d408e518ad78"></a><a id="t.68"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c43">For this workshop, you&rsquo;ll trigger the web hook manually, but if you&rsquo;re running on a system that can receive traffic from the Internet or if you&rsquo;re using a tunneling tool like Inlets or Ngrok you can set up an actual web hook to be triggered from GitHub.</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The first step is to expose the event listener you just deployed through Kourier (very similar to what you&rsquo;ve done with the Tekton dashboard).</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b7e366921b1606529eb969b3d8b9f7ae6dc11808"></a><a id="t.69"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: networking.internal.knative.dev/v1alpha1</span></p><p class="c2"><span class="c1">kind: Ingress</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: el-cicd</span></p><p class="c2"><span class="c1">&nbsp; namespace: default</span></p><p class="c2"><span class="c1">&nbsp; annotations:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; networking.knative.dev/ingress.class: kourier.ingress.networking.knative.dev</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; rules:</span></p><p class="c2"><span class="c1">&nbsp; - hosts:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - &nbsp;el-cicd.default.$KNATIVE_DOMAIN</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; http:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; paths:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; - splits:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - appendHeaders: {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; serviceName: el-cicd</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; serviceNamespace: default</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; servicePort: 8080</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; visibility: ExternalIP</span></p><p class="c2"><span class="c1">&nbsp; visibility: ExternalIP</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can export the web hook as a terminal variable</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.70d858bbaeff46b499db80f79dc060a62509dc51"></a><a id="t.70"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">export </span><span class="c6">GIT_WEBHOOK_URL</span><span class="c21">=</span><span class="c0">http</span><span class="c21">:</span><span class="c26">//el-cicd.default.</span><span class="c6">$KNATIVE_DOMAIN</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.eb4f00c66817d6d5beaffb0a5ce17aa10badd9af"></a><a id="t.71"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image2.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c43">In the spirit of security, please be aware that the URL is HTTP and NOT https. It&rsquo;s not a secure URL so please do not use this for cases where you want security.</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b219b51efb0d1203dbd1e3f8f3ff1fc15ad17b0d"></a><a id="t.72"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">curl </span><span class="c15">-v</span><span class="c0">&nbsp;--request POST </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --url http</span><span class="c21">:</span><span class="c26">//el-cicd.default.127.0.0.1.nip.io/</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --header </span><span class="c1">&#39;content-type: application/json&#39;</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --header </span><span class="c1">&#39;x-github-event: push&#39;</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --data </span><span class="c1">&#39;{</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &quot;ref&quot;: &quot;refs/heads/master&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &quot;repository&quot;: {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;url&quot;: &quot;https://github.com/retgits/simple-node-app&quot;,</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;name&quot;: &quot;simple-node-app&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; },</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &quot;head_commit&quot;: {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &quot;id&quot;: &quot;7919de41971aa3abc6c218e7a823da95861c5a3e&quot;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">}&#39;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>A new Tekton </span><span class="c3">PipelineRun</span><span>&nbsp;gets created starting a new </span><span class="c3">Pipeline</span><span class="c4 c10 c8">&nbsp;Instance. You can check in the Tekton Dashboard for progress of using the tkn CLI.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.280e9b2b93e0adc1bd5ef5e7586b94ffa997db3b"></a><a id="t.73"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">tkn pipeline logs </span><span class="c15">-f</span><span class="c4 c0">&nbsp;--last</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">And to see details of the run, use</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.6e938d77ff9b3f1e8837632f6ee4dfd79c66f5bd"></a><a id="t.74"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">tkn pipelinerun describe --last</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h1 class="c33 c45" id="h.xgmlc2a1vnx"><span class="c12 c8"></span></h1><h1 class="c33" id="h.3eaevdj73que"><span class="c12 c8">Knative Eventing</span></h1><h2 class="c20" id="h.7bh7lshispdt"><span class="c36 c8">Install Knative Eventing to your cluster</span></h2><p class="c2"><span class="c4 c10 c8">So far everything you&rsquo;ve done is with HTTP, in the next section you&rsquo;ll look at the Eventing side of Knative. To start you&rsquo;ll need to install Knative Eventing.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.8e79dbabdc89d83f792cf52b7aecc9123ade26ff"></a><a id="t.75"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">kubectl apply --filename https://github.com/knative/eventing/releases/download/v0.16.0/eventing-crds.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c4 c0">kubectl apply --filename https://github.com/knative/eventing/releases/download/v0.16.0/eventing-core.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c4 c0">kubectl wait deployment eventing-controller eventing-webhook --for=condition=Available -n knative-eventing --timeout=-1s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Next you&rsquo;ll need to install a messaging layer, or Channel in Knative Eventing terms, and for this workshop you&rsquo;ll use the In-Memory channel. This implementation is nice because it is simple and standalone, but it is unsuitable for production use cases.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.4628771758b04ae6842d04e03ec843fc512e4743"></a><a id="t.76"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl apply --filename https</span><span class="c21">:</span><span class="c26">//github.com/knative/eventing/releases/download/v0.16.0/in-memory-channel.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">kubectl wait deployment imc-controller imc-dispatcher --</span><span class="c6">for</span><span class="c21">=</span><span class="c6">condition</span><span class="c21">=</span><span class="c0">Available </span><span class="c15">-n</span><span class="c0">&nbsp;knative-eventing --</span><span class="c6">timeout</span><span class="c21">=</span><span class="c4 c0">-1s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The final step to get things running is to install a broker. This eventing layer utilizes Channels and runs event routing components in a System Namespace. If you&rsquo;ve used Knative Eventing in the past, you&rsquo;ll notice that this is a little different from previous versions, because the broker now provides a smaller and simpler installation.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.105e0462a3c375cda537cc00fea43d49010fb30a"></a><a id="t.77"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">kubectl apply --filename https://github.com/knative/eventing/releases/download/v0.16.0/mt-channel-broker.yaml</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c4 c0">kubectl wait deployment mt-broker-controller mt-broker-filter mt-broker-ingress --for=condition=Available -n knative-eventing --timeout=-1s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">To make sure everything is okay, all pods should be in Running state.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.59ebcd7c6c7c7fcd6eaecd2030a3104ef395a75c"></a><a id="t.78"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">kubectl get pods --namespace knative-eventing</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.dtgghgirpaxc"><span class="c36 c8">Deploying your first event-driven app</span></h2><p class="c2"><span>To use Knative Eventing in a namespace, you&rsquo;ll need to make sure that there&rsquo;s a broker running. The below command will create a new broker called </span><span class="c3">default</span><span>&nbsp;in the namespace </span><span class="c3">default</span><span class="c4 c10 c8">.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.41f042ccdc9dd6d556742928326f9c42fd05e8d6"></a><a id="t.79"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl label namespace default </span><span class="c6">knative-eventing-injection</span><span class="c21">=</span><span class="c4 c0">enabled</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: eventing.knative.dev/v1</span></p><p class="c2"><span class="c1">kind: Broker</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: default</span></p><p class="c2"><span class="c1">&nbsp; namespace: default</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To check that everything has worked, you can run the command </span><span class="c3">kubectl get broker</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To visualize the events, you&rsquo;ll need to have an event display. While Knative has a default (and tools like </span><span class="c42"><a class="c49" href="https://www.google.com/url?q=https://github.com/n3wscott/sockeye&amp;sa=D&amp;ust=1599151576490000&amp;usg=AOvVaw2V8lfzDvW5DB8kUWf_qUvI">Sockeye</a></span><span class="c4 c10 c8">&nbsp;exist as well), let&rsquo;s create one from scratch.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.089826247665ee6fd277b36cb9ad45ee715854b3"></a><a id="t.80"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c18">&gt;</span><span class="c0">&nbsp;monitor</span><span class="c19">.</span><span class="c0">py </span><span class="c19">&lt;&lt; </span><span class="c18">EOF</span></p><p class="c2"><span class="c1">import json</span></p><p class="c2"><span class="c1">import logging</span></p><p class="c2"><span class="c1">import os</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">from flask import Flask, request</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">app = Flask(__name__)</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">@app.route(&#39;/&#39;, methods=[&#39;POST&#39;])</span></p><p class="c2"><span class="c1">def pubsub_push():</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; message = json.loads(request.data.decode(&#39;utf-8&#39;))</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; info(f&#39;Event Display received message:</span><span class="c13">\n</span><span class="c1">{message}&#39;)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; return &#39;OK&#39;, 200</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">def info(msg):</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; app.logger.info(msg)</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">if __name__ != &#39;__main__&#39;:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; # Redirect Flask logs to Gunicorn logs</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; gunicorn_logger = logging.getLogger(&#39;gunicorn.error&#39;)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; app.logger.handlers = gunicorn_logger.handlers</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; app.logger.setLevel(gunicorn_logger.level)</span></p><p class="c2"><span class="c1">else:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; app.run(debug=True, host=&#39;0.0.0.0&#39;, port=int(os.environ.get(&#39;PORT&#39;, 8080)))</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You&rsquo;ll need to create a docker container out of that.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.783bd4e698deac5c04e93d1c72f0778cea8ee31a"></a><a id="t.81"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c18">&gt;</span><span class="c0">&nbsp;Dockerfile </span><span class="c19">&lt;&lt; </span><span class="c18">EOF</span></p><p class="c2"><span class="c1">FROM python:3.7-slim</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">RUN pip install Flask gunicorn</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">WORKDIR /app</span></p><p class="c2"><span class="c1">COPY monitor.py .</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c1">CMD exec gunicorn --bind :</span><span class="c13">\$</span><span class="c1">PORT --workers 1 --threads 8 monitor:app</span></p><p class="c2"><span class="c18">EOF</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">docker build </span><span class="c19">.</span><span class="c0">&nbsp;</span><span class="c15">-t</span><span class="c0">&nbsp;</span><span class="c18">&lt;</span><span class="c0">docker username</span><span class="c18">&gt;</span><span class="c26">/display</span></p><p class="c2 c9"><span class="c4 c0"></span></p><p class="c2"><span class="c0">docker push </span><span class="c18">&lt;</span><span class="c0">docker username</span><span class="c18">&gt;</span><span class="c26">/display</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can run a container and see what the result looks like.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.576041d437dfd74b3de59f3bc126d70e68539fc2"></a><a id="t.82"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">docker run --rm -it </span><span class="c15">-e</span><span class="c0">&nbsp;</span><span class="c6">PORT</span><span class="c21">=</span><span class="c25">8080</span><span class="c0">&nbsp;</span><span class="c15">-p</span><span class="c0">&nbsp;</span><span class="c25">8080</span><span class="c21">:</span><span class="c25">8080</span><span class="c0">&nbsp;</span><span class="c18">&lt;</span><span class="c0">docker username</span><span class="c18">&gt;</span><span class="c26">/display</span><span class="c21">:</span><span class="c4 c0">latest</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">And in a different terminal window, run the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.f614da6fb70334ca6de029a58c11f58369cf1bb3"></a><a id="t.83"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">curl --request POST </span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --url http</span><span class="c21">:</span><span class="c26">//localhost</span><span class="c21">:</span><span class="c25">8080</span><span class="c26">/</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --header </span><span class="c1">&#39;content-type: application/json&#39;</span><span class="c0">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c0">&nbsp; --data </span><span class="c1">&#39;{</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;hello&quot;: &quot;springone&quot;</span></p><p class="c2"><span class="c1">}&#39;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You&rsquo;re now ready to deploy the display. You&rsquo;ll need to keep it running, so the minimal number of replicas needs to be set to </span><span class="c3">1</span><span class="c4 c10 c8">.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.9b36705928500471f6f418453eaea8b4fda1e92b"></a><a id="t.84"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service create event-display --image </span><span class="c18">&lt;</span><span class="c0">docker username</span><span class="c18">&gt;</span><span class="c26">/display</span><span class="c21">:</span><span class="c0">latest --min-scale </span><span class="c25">1</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can check that the service was created with the below command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.1cf2239d635f4d334ab9103ee13ebb837c104c14"></a><a id="t.85"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c4 c0">kn service list event-display</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You&rsquo;ll need to connect the display to the Broker with a trigger. The trigger makes sure that the event received on the broker is sent to the right service (in Knative terminology, these are called event sinks). In the trigger is a filter attribute of </span><span class="c3">type: springoneworkshop</span><span class="c4 c10 c8">. That means only events with that particular field set will be sent to the display. The subscriber &nbsp;is a reference to the event-display service you deployed just now.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.142978a7ef8c262551d7d309082dfde9b3a589e0"></a><a id="t.86"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: eventing.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Trigger</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: trigger-display</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; filter:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; attributes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; type: springoneworkshop</span></p><p class="c2"><span class="c1">&nbsp; subscriber:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: event-display</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>You can validate the trigger has been created successfully with </span><span class="c3">kubectl get trigger</span><span class="c4 c10 c8">.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">To get some events flowing, you&rsquo;d normally open up your ingress routes. In this case, you&rsquo;ll create a pod that will act as an event producer and send events using the below curl command.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2caaffce6fd89b8ef6b039cb1b41c82e71023cdd"></a><a id="t.87"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: v1</span></p><p class="c2"><span class="c1">kind: Pod</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; labels:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; run: curl</span></p><p class="c2"><span class="c1">&nbsp; name: curl</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; containers:</span></p><p class="c2"><span class="c1">&nbsp; - image: radial/busyboxplus:curl</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; imagePullPolicy: IfNotPresent</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; name: curl</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; resources: {}</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; stdin: true</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; terminationMessagePath: /dev/termination-log</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; terminationMessagePolicy: File</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; tty: true</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">In a different terminal window, you&rsquo;ll tail the logs to see what&rsquo;s happening. To start you&rsquo;ll need the name of the pod of the display service.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.86dc835180eea08a555382618c08c4c189ecf963"></a><a id="t.88"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">$</span><span class="c0">&nbsp;kubectl get pods </span><span class="c15">-n</span><span class="c4 c0">&nbsp;default</span></p><p class="c2"><span class="c4 c0">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY &nbsp; STATUS &nbsp; &nbsp;RESTARTS &nbsp; AGE</span></p><p class="c2"><span class="c0">curl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c25">1</span><span class="c26">/1</span><span class="c0">&nbsp; &nbsp; &nbsp;Running &nbsp; </span><span class="c25">0</span><span class="c4 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 80s</span></p><p class="c2"><span class="c0">event-display-dphdw-</span><span class="c25">1</span><span class="c0">-deployment-6c6695864f-ds9g2 &nbsp; </span><span class="c25">2</span><span class="c26">/2</span><span class="c0">&nbsp; &nbsp; &nbsp;Running &nbsp; </span><span class="c25">0</span><span class="c4 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8m50s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">To stream the logs, run the below command</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.1ac2af26e01a4e296111af50002775140a7c2eba"></a><a id="t.89"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl logs </span><span class="c15">-f</span><span class="c0">&nbsp;event-display-dphdw-</span><span class="c25">1</span><span class="c0">-deployment-6c6695864f-ds9g2 </span><span class="c15">-c</span><span class="c0">&nbsp;user-container</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">In your first terminal window, now create an SSH session to the curl pod</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.606a59531d5962cd7fa0f0cb98a5c796d33a6644"></a><a id="t.90"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kubectl attach curl -it</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">From there you can send an event using curl. This will give you a message in the logs.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.6569ae8c312fe05d0dff5b8725d4fb5db7ba0f48"></a><a id="t.91"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">curl </span><span class="c15">-v</span><span class="c6">&nbsp;</span><span class="c1">&quot;http:</span><span class="c26">//broker-ingress.knative-eventing.svc.cluster.local/default/default</span><span class="c1">&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -X POST </span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Id: workshop&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Specversion: 1.0&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Type: springoneworkshop&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Source: curl-pod&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Content-Type: </span><span class="c26">application/json</span><span class="c1">&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; </span><span class="c15">-d</span><span class="c6">&nbsp;</span><span class="c1">&#39;{&quot;msg&quot;:&quot;Hello SpringOne Workshop&quot;}&#39;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Similarly, the below message will not give you a log entry because the type doesn&rsquo;t match.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.5a6a1b50cc4c03d117d338b3eaac041bea8c8646"></a><a id="t.92"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">curl </span><span class="c15">-v</span><span class="c6">&nbsp;</span><span class="c1">&quot;http:</span><span class="c26">//broker-ingress.knative-eventing.svc.cluster.local/default/default</span><span class="c1">&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -X POST </span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Id: workshop&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Specversion: 1.0&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Type: helloworld&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Ce-Source: curl-pod&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; -H </span><span class="c1">&quot;Content-Type: </span><span class="c26">application/json</span><span class="c1">&quot;</span><span class="c6">&nbsp;</span><span class="c13">\</span></p><p class="c2"><span class="c6">&nbsp; </span><span class="c15">-d</span><span class="c6">&nbsp;</span><span class="c1">&#39;{&quot;msg&quot;:&quot;Hello SpringOne Workshop&quot;}&#39;</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.47nw6x4hlm8e"><span class="c8 c36">Events without brokers and triggers</span></h2><p class="c2"><span class="c4 c10 c8">As a best practice, you want to leverage brokers and triggers for all your eventing. It makes it a lot more straight-forward when you need to update implementations or add some additional subscribers. However, it does work without brokers and triggers too&hellip;</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>To simulate some events, you&rsquo;ll use the </span><span class="c3">PingSource</span><span class="c4 c10 c8">. That event source is capable of sending CloudEvents events based on a cron schedule. You can use your existing display service to receive and log the events.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2b05a2f720563a522b3b419260969875e7e4933e"></a><a id="t.93"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: sources.knative.dev/v1alpha2</span></p><p class="c2"><span class="c1">kind: PingSource</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: source</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; schedule: &quot;* * * * *&quot;</span></p><p class="c2"><span class="c1">&nbsp; jsonData: &#39;{&quot;message&quot;: &quot;Hello SpringOne World!&quot;}&#39;</span></p><p class="c2"><span class="c1">&nbsp; sink:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: event-display</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">This schedule will send a message every minute, so for now you&rsquo;ll have to wait a little to see the output&hellip;</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The reason you usually want to leverage brokers and triggers is that in case you now want to add a second display function to receive the messages, you&rsquo;d need to update the PingSource deployment. Instead, with triggers and brokers you could add a new trigger.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.bw0ab9xfz0kv"><span class="c36 c8">More than one source</span></h2><p class="c2"><span class="c4 c10 c8">Let&rsquo;s update the previous example a little to make sure it follows best practices (and you&rsquo;ll add a second receiver of the message too). The first step is to remove the PingSource, because you&rsquo;ll create a new one later on.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0044eb5970b3bf7e8c701a6da3979d5a9020ac35"></a><a id="t.94"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">kubectl delete pingsource</span><span class="c19">.</span><span class="c6">sources</span><span class="c19">.</span><span class="c6">knative</span><span class="c19">.</span><span class="c6">dev source</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The first step is to create a Channel. In Knative terminology, a channel takes care of message persistence and forwarding. In this case, you&rsquo;ll use the InMemory channel which isn&rsquo;t persistent but as you&rsquo;re not running $10M transactions over your machine right now that&rsquo;s probably okay.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.bdf5862fbd76c4e29083a82a5856b1acda2f0767"></a><a id="t.95"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: InMemoryChannel</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: channel</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The new PingSource will leverage the channel to send events to</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.2c8342101a463bf4610c74f71720020d1771a9d5"></a><a id="t.96"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: sources.knative.dev/v1alpha2</span></p><p class="c2"><span class="c1">kind: PingSource</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: source</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; schedule: &quot;* * * * *&quot;</span></p><p class="c2"><span class="c1">&nbsp; jsonData: &#39;{&quot;message&quot;: &quot;Hello SpringOne World Channel!&quot;}&#39;</span></p><p class="c2"><span class="c1">&nbsp; sink:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: InMemoryChannel</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: channel</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>Let&rsquo;s add a second display. You&rsquo;ll need to keep it running as well, so the minimal number of replicas needs to be set to </span><span class="c3">1</span><span class="c4 c10 c8">.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.0602d40236777407b97e9336eb345766adfb3df6"></a><a id="t.97"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c0">kn service create event-display2 --image </span><span class="c18">&lt;</span><span class="c0">docker username</span><span class="c18">&gt;</span><span class="c26">/display</span><span class="c21">:</span><span class="c0">latest --min-scale </span><span class="c25">1</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The command </span><span class="c3">kn service list</span><span class="c4 c10 c8">&nbsp;should now show two services running.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The next step is to create subscriptions. These subscriptions tie the services to the channel and let the channel know which services need to get messages.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.7c96565ed20294b377972900ee9f5c72d46bca8d"></a><a id="t.98"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Subscription</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: sub1</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; channel:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; kind: InMemoryChannel</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; name: channel</span></p><p class="c2"><span class="c1">&nbsp; subscriber:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: event-display</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.539d1228ab1b2327d04107ef083e015bb7db81bf"></a><a id="t.99"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Subscription</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: sub2</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; channel:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; kind: InMemoryChannel</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; name: channel</span></p><p class="c2"><span class="c1">&nbsp; subscriber:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: event-display2</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">As soon as you create the subscriptions, the messages are received by the event display services. You can verify that in the same way as before by running the logs command. To start you&rsquo;ll need the name of the pod of the display services.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.6faf1b8d11596889d6fb8ca026e6e676dabf6a76"></a><a id="t.100"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">$</span><span class="c0">&nbsp;kubectl get pods </span><span class="c15">-n</span><span class="c4 c0">&nbsp;default</span></p><p class="c2"><span class="c4 c0">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY &nbsp; STATUS &nbsp; &nbsp;RESTARTS &nbsp; AGE</span></p><p class="c2"><span class="c0">curl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c25">1</span><span class="c26">/1</span><span class="c0">&nbsp; &nbsp; &nbsp;Running &nbsp; </span><span class="c25">2</span><span class="c4 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 33m</span></p><p class="c2"><span class="c0">event-display-dphdw-</span><span class="c25">1</span><span class="c0">-deployment-6c6695864f-ds9g2 &nbsp; &nbsp;</span><span class="c25">2</span><span class="c26">/2</span><span class="c0">&nbsp; &nbsp; &nbsp;Running &nbsp; </span><span class="c25">0</span><span class="c4 c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 41m</span></p><p class="c2"><span class="c0">event-display2-lmbdd-</span><span class="c25">1</span><span class="c0">-deployment-77dd94f5d6-cpnc4 &nbsp; </span><span class="c25">2</span><span class="c26">/2</span><span class="c0">&nbsp; &nbsp; &nbsp;Running &nbsp; </span><span class="c25">0</span><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5m6s</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">To stream the logs, run these commands in separate terminal windows</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.ac17709c9ab1582eb03578928d26e3aa9929c9bd"></a><a id="t.101"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">kubectl logs </span><span class="c15">-f</span><span class="c6">&nbsp;event-display-dphdw-</span><span class="c25">1</span><span class="c6">-deployment-6c6695864f-ds9g2 </span><span class="c15">-c</span><span class="c4 c6">&nbsp;user-container</span></p><p class="c2 c9"><span class="c4 c6"></span></p><p class="c2"><span class="c6">kubectl logs </span><span class="c15">-f</span><span class="c6">&nbsp;event-display2-lmbdd-</span><span class="c25">1</span><span class="c6">-deployment-77dd94f5d6-cpnc4 </span><span class="c15">-c</span><span class="c4 c6">&nbsp;user-container</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h2 class="c20" id="h.psl5jzby3xbk"><span class="c36 c8">Sequence of events</span></h2><p class="c2"><span class="c4 c10 c8">When you&rsquo;re building functionality, it can be useful to split up functionality into smaller chunks. For example, in Unix operating systems the idea is that each command like tool does only one thing. Using the concepts of pipe and tee, you can string these commands together. Looking at the Pull Request example, you could have a function that strips out sensitive (Personally Identifiable Information or PII). That functionality can be very useful to other flows too, so you can create a function that does only that one thing. The output of that function feeds into other functions, chaining functions together into a longer sequence.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 473.00px; height: 92.66px;"><img alt="" src="images/image5.png" style="width: 473.00px; height: 92.66px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">First, you&rsquo;ll have to create the display that will show the final event (consumer 2). In this case you&rsquo;ll use a different display than you&rsquo;ve used so far.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.494edc8f2a2a0d0ba334b43063bf6a9dffe0a250"></a><a id="t.102"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl create -f -</span></p><p class="c2"><span class="c1">apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">kind: Service</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: event-display-chain</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; template:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; spec:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; containers:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - image: gcr.io/knative-releases/knative.dev/eventing-contrib/cmd/event_display</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Next, you&rsquo;ll have to create a function that reacts to the event (consumer 1) and sends it onwards while modifying it a little bit too.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b876e2d00afac88e03b1e771503e141bf90d5dd7"></a><a id="t.103"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl create -f -</span></p><p class="c2"><span class="c1">apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">kind: Service</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: first</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; template:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; spec:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; containers:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; - image: gcr.io/knative-releases/knative.dev/eventing-contrib/cmd/appender</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; env:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: MESSAGE</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value: &quot; - Updating this message a little...&quot;</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">The sequence construct uses a channel to make sure the different steps are executed. In this case it makes sure that the service &ldquo;first&rdquo; is executed and that the result is passed on to the service &ldquo;event-display-chain&rdquo;</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.b7a035520bcb8974132ebfe53fb95fa07ca420be"></a><a id="t.104"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl create -f -</span></p><p class="c2"><span class="c1">apiVersion: flows.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Sequence</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: sequence</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; channelTemplate:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; apiVersion: messaging.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; kind: InMemoryChannel</span></p><p class="c2"><span class="c1">&nbsp; steps:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; - ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; name: first</span></p><p class="c2"><span class="c1">&nbsp; reply:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: event-display-chain</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">Finally, you&rsquo;ll need to create a PingSource (producer) that sends a new message to the sequence every minute.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.6d19d02f1ff1ab79b659600400796ac3262687d8"></a><a id="t.105"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl create -f -</span></p><p class="c2"><span class="c1">apiVersion: sources.knative.dev/v1alpha2</span></p><p class="c2"><span class="c1">kind: PingSource</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: ping-source-sequence</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; schedule: &quot;* * * * *&quot;</span></p><p class="c2"><span class="c1">&nbsp; jsonData: &#39;{&quot;message&quot;: &quot;Hello Knative!&quot;}&#39;</span></p><p class="c2"><span class="c1">&nbsp; sink:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: flows.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Sequence</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: sequence</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">You can check that the sequence was executed and the messages was updated by running the command below.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.900cea27bb26355e99692e628a3fd0073c0747f0"></a><a id="t.106"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">kubectl </span><span class="c15">-n</span><span class="c6">&nbsp;default logs -l </span><span class="c26">serving.knative.dev/service</span><span class="c6">=event-display-chain </span><span class="c15">-c</span><span class="c6">&nbsp;user-container --tail</span><span class="c21">=</span><span class="c6">-</span><span class="c25">1</span></p></td></tr></tbody></table><h2 class="c20" id="h.ex35lvywecp0"><span class="c36 c8">Using the Event registry</span></h2><p class="c2"><span class="c4 c10 c8">In Knative Eventing, the Event Registry maintains a catalog of the event types that can be consumed from the different Brokers. It helps you discover the different types of events you can consume from the Brokers&rsquo; event meshes.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span class="c4 c10 c8">To make sure there are events flowing through the broker, you&rsquo;ll need to create a new PingSource that sends messages to the broker.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.dd4193b2cb95c1d8885ec8d93b24b1b52274b2b0"></a><a id="t.107"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: sources.knative.dev/v1alpha2</span></p><p class="c2"><span class="c1">kind: PingSource</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: brokersource</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; schedule: &quot;* * * * *&quot;</span></p><p class="c2"><span class="c1">&nbsp; jsonData: &#39;{&quot;message&quot;: &quot;Hello SpringOne World Broker!&quot;}&#39;</span></p><p class="c2"><span class="c1">&nbsp; sink:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: eventing.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Broker</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: default</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><p class="c2 c9"><span class="c4 c10 c8"></span></p><p class="c2"><span>The command </span><span class="c3">kubectl get eventtypes -n default</span><span>&nbsp;will now show the new PingSource event. &nbsp;In more detail, you can use </span><span class="c3">kubectl get eventtype &lt;name of the event&gt; -o yaml</span><span>&nbsp;to see the meta data of the event. The </span><span class="c3">spec.type</span><span class="c4 c10 c8">&nbsp;field can be used to create triggers. For the final piece of this workshop, you&rsquo;ll create a trigger to get messages from the broker into the display service.</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.e678db7cc152a75dd592b221615b2f3395435c30"></a><a id="t.108"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image1.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span class="c6">cat </span><span class="c19">&lt;&lt;</span><span class="c18">EOF</span><span class="c1">&nbsp;| kubectl apply -f -</span></p><p class="c2"><span class="c1">apiVersion: eventing.knative.dev/v1beta1</span></p><p class="c2"><span class="c1">kind: Trigger</span></p><p class="c2"><span class="c1">metadata:</span></p><p class="c2"><span class="c1">&nbsp; name: trigger-broker</span></p><p class="c2"><span class="c1">spec:</span></p><p class="c2"><span class="c1">&nbsp; filter:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; attributes:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; type: dev.knative.sources.ping</span></p><p class="c2"><span class="c1">&nbsp; subscriber:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; ref:</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; apiVersion: serving.knative.dev/v1</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; kind: Service</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; name: event-display</span></p><p class="c2"><span class="c18">EOF</span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><hr style="page-break-before:always;display:none;"><h2 class="c20 c35" id="h.hev6xr9ry8yu"><span class="c36 c8"></span></h2><h2 class="c20" id="h.9nyxu75hf7d3"><span class="c36 c8">Building complex eventing sequences</span></h2><p class="c2"><span class="c4 c10 c8">With the knowledge from the above sections, can you build the below diagram? It has two event sources that both can trigger function 1 and based on the original source emits an updated version of the event to a different function. Your sources should be able to be triggered by Tekton triggers. You might need to write some code to do this, and you definitely want to check everything in Octant &nbsp;:)</span></p><p class="c2 c9"><span class="c4 c10 c8"></span></p><a id="t.f727949b760321cc972232d42b2d9fa1f8785d82"></a><a id="t.109"></a><table class="c7"><tbody><tr class="c16"><td class="c17" colspan="1" rowspan="1"><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 54.00px; height: 54.67px;"><img alt="" src="images/image3.png" style="width: 54.00px; height: 54.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c11" colspan="1" rowspan="1"><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 473.00px; height: 279.10px;"><img alt="" src="images/image6.png" style="width: 473.00px; height: 279.10px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></tbody></table><p class="c2 c9"><span class="c4 c10 c8"></span></p><h1 class="c33" id="h.9vyvoczaxpgx"><span class="c12 c8">Cleaning up</span></h1><p class="c2"><span>Now that you&rsquo;re done, you can keep the cluster running or shut it down with </span><span class="c3">kind delete cluster --name springone</span><span class="c4 c10 c8">.</span></p></body></html>